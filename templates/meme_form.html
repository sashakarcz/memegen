<!DOCTYPE html>
<html lang="en">
<head>
    <title>Create a Meme</title>
    <!-- Material Design CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.3.0/material.indigo-pink.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.3.0/material.min.js"></script>
    <link rel="stylesheet" href="/static/styles.css">
    
    <script>
        function updatePreview() {
            let template = document.getElementById("template").value;
            let topText = document.getElementById("top").value.trim();
            let bottomText = document.getElementById("bottom").value.trim();

            // Replace spaces with underscores
            topText = topText ? encodeURIComponent(topText.replace(/ /g, "_")) : "_";
            bottomText = bottomText ? encodeURIComponent(bottomText.replace(/ /g, "_")) : "_";

            // Use Fiber Proxy instead of calling localhost:5002 directly
            let previewUrl = `/api/images/${template}/${topText}/${bottomText}.png`;
            document.getElementById("memePreview").src = previewUrl;
        }
    </script>
</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <!-- Header -->
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Create a Meme</span>
                <div class="mdl-layout-spacer"></div>
                <a href="/" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                    Home
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="mdl-layout__content">
            <div class="page-content" style="text-align: center; padding: 20px;">
                <form action="/generate" method="post" class="mdl-card mdl-shadow--2dp" style="padding: 20px; max-width: 500px; margin: auto;">
                    
                    <!-- Template Selection -->
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <select id="template" name="template" class="mdl-textfield__input" onchange="updatePreview()">
                            {{range .}}
                            <option value="{{.ID}}">{{.Name}}</option>
                            {{end}}
                        </select>
                        <label class="mdl-textfield__label">Choose a Meme Template</label>
                    </div>

                    <!-- Top Text -->
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <input type="text" id="top" name="top" class="mdl-textfield__input" oninput="updatePreview()">
                        <label class="mdl-textfield__label" for="top">Top Text</label>
                    </div>

                    <!-- Bottom Text -->
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <input type="text" id="bottom" name="bottom" class="mdl-textfield__input" oninput="updatePreview()">
                        <label class="mdl-textfield__label" for="bottom">Bottom Text</label>
                    </div>

                    <!-- Context -->
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                      <textarea id="context" name="context" class="mdl-textfield__input"></textarea>
                      <label class="mdl-textfield__label" for="context">Add context (optional, e.g., news article, joke explanation)</label>
                    </div>

                    <!-- Link -->
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                      <input type="url" id="link" name="link" class="mdl-textfield__input">
                      <label class="mdl-textfield__label" for="link">External link (optional, e.g., news article)</label>
                    </div>

                    <!-- Preview -->
                    <img id="memePreview" src="" alt="Meme Preview" style="max-width: 100%; border: 2px solid #ddd; border-radius: 5px; padding: 10px;">
                    
                    <!-- Buttons -->
                    <div style="margin-top: 20px;">
                        <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                            Generate Meme
                        </button>
                        <a href="/" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </main>
    </div>
</body>
</html>
